language: python
sudo: false
cache:
  directories:
  - $HOME/.cache/pip
  - $HOME/protobuf
  - $HOME/google-cloud-sdk
python:
- '2.7'
before_install:
- /bin/bash travis/install_protobuf.sh
env:
# From https://goo.gl/XuEMpi GCP CD with travis
- PROTOC="${HOME}/protobuf/bin/protoc" PATH=$PATH:${HOME}/google-cloud-sdk/bin CLOUDSDK_CORE_DISABLE_PROMPTS=1
install:
#- pip install --upgrade pip wheel setuptools
#- pip install -e .
#- pip install -e grr/config/grr-response-server/
#- pip install -e grr/config/grr-response-test/
#- python makefile.py
#- cd grr/artifacts && python makefile.py && cd -
#script: grr_run_tests --processes=2
script:
  - /bin/bash travis/deploy_to_gcs.sh
# This should work but it doesn't
#deploy:
#  provider: script
#  script:/bin/bash travis/deploy_to_gcs.sh
#  on:
#    branch: travis-testing
addons:
  apt:
    packages:
    - libffi-dev
    - libssl-dev
    - python-dev
    - prelink

